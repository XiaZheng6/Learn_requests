<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
</head>
<body>

    <div id="txtcontent" style="width: 500px;height: 250px;border: 1px solid gray;overflow: auto;"></div>
    <div>你的昵称:<input type="text" id="username" /></div>
    <div>
        回复内容:
        <textarea style="width: 500px;height: 100px" id="txtmsg"></textarea>
    </div>
    <div>
        <button onclick="send()">发送消息</button>
    </div>
</body>


<script src='https://cdn.bootcss.com/socket.io/2.0.3/socket.io.js'></script>
<script>
var isLogin = false; //是否登录到服务器上
function send(){
	var msg = document.getElementById('txtmsg').value;
	var username = document.getElementById('username').value;
	if (username == ''){
        alert('用户昵称必填');
    }
	
    // 如果服务端不在本机，请把127.0.0.1改成服务端ip
    var socket = io('http://43.254.88.175:2050');
    //触发服务端的chat message事件
    if (!isLogin){
        var str1 = '{"type":"login","name":"'+username+'","pwd":"123456"}';
    	var obj1 = JSON.parse(str1);
    	socket.emit('chat message',obj1);
    	console.log("login");
    }

    var str2 = '{"type":"say","name":"'+username+'","content":"'+msg+'","time":"123456"}';
    var obj2 = JSON.parse(str2);
    socket.emit('message', obj2);
    console.log("send message");
    
    socket.on('server', function(msg){
    	console.log("server:"+msg);
    	var jsonObj = JSON.parse(msg);
    	//var jsonObj = msg;
		var getMsg = jsonObj.content;
        var type = jsonObj.type;
        if(type == 'login'){ //服务器验证通过
            isLogin = true;

            var p = document.createElement('p');
            p.innerHTML = '<span>收到消息:</span>' + getMsg;
            document.getElementById('txtcontent').appendChild(p);

            console.log("login success");
        }else if(type == 'say'){ //代表是普通消息
            var p = document.createElement('p');
            p.innerHTML = '<span>收到消息:</span>' + getMsg;
            document.getElementById('txtcontent').appendChild(p);

            console.log("send message success");
        }else if(type == 'push'){ //代表是推送消息
            var p = document.createElement('p');
            p.innerHTML = '<span>收到推送消息:</span>' + getMsg;
            document.getElementById('txtcontent').appendChild(p);
        }
    });
}
</script>

</html>
